* { box-sizing: border-box; }
html, body, #app { height: 100%; margin: 0; }
:root{
  --ink:#2b2b2b; --ink-soft:#5a544a; --paper:#e9e0cf; --paper-dark:#d9cdb3;
  --accent:#8f6b3a; --chip:#efe7d3; --chip-ink:#4b473e;
}
body{ background:var(--paper); color:var(--ink); }
header{
  display:flex; gap:12px; align-items:center; justify-content:space-between;
  padding:10px 12px; background:linear-gradient(180deg, #2b2b2b, #1f1f1f);
  color:#eee; font-family: system-ui, ui-sans-serif, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
  position: sticky; top:0; z-index:1000; box-shadow: 0 2px 12px rgba(0,0,0,.25);
}
header h1{ font-size:16px; margin:0; letter-spacing:.3px; }
.header-actions { display:flex; gap:8px; align-items:center; }
#gmToggle{
  background:#3a3a3a; color:#eee; border:1px solid #5b5b5b; border-radius:999px; padding:7px 12px;
}

#toolbar{
  position: sticky; top:48px; z-index: 990; background: #f4edda; border-bottom:1px solid #e0d7c1;
  padding: 8px 12px; font-family: system-ui, ui-sans-serif, Segoe UI, Roboto, Helvetica, Arial;
}
#toolbar .filters { display:flex; flex-wrap:wrap; gap:10px; margin-top:6px; }
#toolbar input[type="search"]{
  width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d8cfb8; background:#fff;
}
#toolbar .hint { font-size: 12px; color:#6f6656; margin-top:6px; }

#map-wrap{ position: relative; height: calc(100% - 56px - 100px); }
#map{
  width:100%; height: 100%;
  background:
    radial-gradient(1200px 600px at 20% 20%, rgba(0,0,0,.08), transparent 60%),
    var(--paper);
}

/* Fog canvas sits above map tiles but under popups */
#fog{
  position: absolute; inset:0; z-index: 400; /* tooltips are ~650, markers 600 */
  pointer-events: none; /* toggled in GM mode */
}

.leaflet-marker-icon .poi-chip{
  display:flex; align-items:center; justify-content:center;
  width:32px; height:32px; border-radius:10px;
  background: #fff; border:1px solid rgba(0,0,0,.15);
  box-shadow: 0 6px 15px rgba(0,0,0,.18);
  transform: translateY(-2px);
}
.leaflet-tooltip{ font-family: system-ui, sans-serif; font-weight: 600; }

#sheet{
  position: fixed; left: 0; right: 0; bottom: 0; max-height: 56%;
  background: #fff; border-top-left-radius: 18px; border-top-right-radius: 18px;
  box-shadow: 0 -10px 30px rgba(0,0,0,.25); padding: 14px 14px 18px; overflow:auto;
  font-family: system-ui, ui-sans-serif, Segoe UI, Roboto, Helvetica, Arial;
  transform: translateY(8px); opacity: 0; transition: opacity .18s ease, transform .18s ease;
}
#sheet.show{ transform: translateY(0); opacity: 1; }
#sheet .handle{
  width: 44px; height: 5px; background: #ddd; border-radius: 999px; margin: 0 auto 10px;
}
#sheet h2{ margin: 6px 0 2px; font-size: 20px; }
#sheet .sub{ font-size: 12px; color:#777; margin-bottom: 10px; }
#sheet .tags{ display:flex; flex-wrap:wrap; gap:6px; margin:10px 0 12px; }
#sheet .tag{
  background: var(--chip); color: var(--chip-ink); border:1px solid #ded6c1;
  padding:4px 8px; border-radius: 999px; font-size: 12px;
}
#sheet img.cover{
  width:100%; border-radius:12px; border:1px solid #eee; display:block; margin:8px 0 10px;
}
#sheet .grid{ display:grid; grid-template-columns: 1fr; gap:10px; }
#sheet .card{
  border:1px solid #eee; border-radius:12px; padding:10px; background:#faf8f2;
}
.actions{ display:flex; gap:8px; flex-wrap:wrap; }
.actions button{
  background: #f3efe5; border:1px solid #d8cfb8; padding:8px 10px; border-radius:10px;
}

.gm #map{ outline: 3px dashed #c77; outline-offset: -3px; }